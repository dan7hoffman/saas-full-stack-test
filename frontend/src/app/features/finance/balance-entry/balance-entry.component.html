<div class="max-w-5xl mx-auto p-6">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Enter Balance Data</h1>
    <p class="text-gray-600">Enter your account and liability balances for a specific date</p>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="flex items-center justify-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      <p class="ml-4 text-gray-600">Loading accounts...</p>
    </div>
  }

  <!-- Error Banner -->
  @if (error()) {
    <div class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start justify-between">
      <div class="flex items-start">
        <span class="text-red-600 text-xl mr-3">⚠️</span>
        <div>
          <h3 class="font-semibold text-red-800 mb-1">Error</h3>
          <p class="text-red-700 text-sm">{{ error() }}</p>
        </div>
      </div>
      <button
        (click)="dismissError()"
        class="text-red-400 hover:text-red-600 transition-colors"
      >
        ✕
      </button>
    </div>
  }

  <!-- Success Banner -->
  @if (successMessage()) {
    <div class="mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-start justify-between">
      <div class="flex items-start">
        <span class="text-green-600 text-xl mr-3">✓</span>
        <div>
          <h3 class="font-semibold text-green-800 mb-1">Success</h3>
          <p class="text-green-700 text-sm">{{ successMessage() }}</p>
        </div>
      </div>
      <button
        (click)="dismissSuccess()"
        class="text-green-400 hover:text-green-600 transition-colors"
      >
        ✕
      </button>
    </div>
  }

  @if (!loading()) {
    <!-- Date Selection -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Select Date</h2>

      <div class="space-y-4">
        <!-- Quarterly Presets -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Quick Select (Current Year)</label>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
            <button
              (click)="setQuarterlyDate(1)"
              class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 hover:border-blue-400 transition-colors text-sm font-medium"
            >
              Q1 (Mar 31)
            </button>
            <button
              (click)="setQuarterlyDate(2)"
              class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 hover:border-blue-400 transition-colors text-sm font-medium"
            >
              Q2 (Jun 30)
            </button>
            <button
              (click)="setQuarterlyDate(3)"
              class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 hover:border-blue-400 transition-colors text-sm font-medium"
            >
              Q3 (Sep 30)
            </button>
            <button
              (click)="setQuarterlyDate(4)"
              class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 hover:border-blue-400 transition-colors text-sm font-medium"
            >
              Q4 (Dec 31)
            </button>
          </div>
        </div>

        <!-- Custom Date -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Or Select Custom Date</label>
          <input
            type="date"
            [value]="selectedDate()"
            (change)="onDateChange($any($event.target).value)"
            class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          />
        </div>

        <!-- Selected Date Display -->
        <div class="text-sm text-gray-600">
          Entering balances for: <span class="font-semibold text-gray-900">{{ formatDate(selectedDate()) }}</span>
        </div>
      </div>
    </div>

    <!-- Net Worth Preview -->
    <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-lg p-6 mb-6 text-white">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <p class="text-blue-100 text-sm mb-1">Total Assets</p>
          <p class="text-2xl font-bold">{{ formatCurrency(totalAccounts()) }}</p>
        </div>
        <div>
          <p class="text-blue-100 text-sm mb-1">Total Liabilities</p>
          <p class="text-2xl font-bold">{{ formatCurrency(totalLiabilities()) }}</p>
        </div>
        <div>
          <p class="text-blue-100 text-sm mb-1">Net Worth</p>
          <p class="text-3xl font-bold">{{ formatCurrency(netWorth()) }}</p>
        </div>
      </div>
    </div>

    <!-- Accounts Section -->
    @if (accounts().length > 0) {
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
          <span class="w-2 h-2 bg-blue-600 rounded-full mr-2"></span>
          Assets
        </h2>

        <div class="space-y-4">
          @for (account of accounts(); track account.id) {
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
              <div class="mb-3 sm:mb-0 sm:flex-1">
                <h3 class="font-medium text-gray-900">{{ account.name }}</h3>
                <p class="text-sm text-gray-600">{{ account.type }}</p>
                @if (getPreviousBalance(account) !== null) {
                  <p class="text-xs text-gray-500 mt-1">
                    Previous: {{ formatCurrency(getPreviousBalance(account)) }}
                  </p>
                }
              </div>
              <div class="flex items-center space-x-2">
                <span class="text-gray-600">$</span>
                <input
                  type="number"
                  step="0.01"
                  [value]="getBalance('account-' + account.id) ?? ''"
                  (input)="updateBalance('account-' + account.id, $any($event.target).value)"
                  placeholder="0.00"
                  class="w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Liabilities Section -->
    @if (liabilities().length > 0) {
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
          <span class="w-2 h-2 bg-red-600 rounded-full mr-2"></span>
          Liabilities
        </h2>

        <div class="space-y-4">
          @for (liability of liabilities(); track liability.id) {
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
              <div class="mb-3 sm:mb-0 sm:flex-1">
                <h3 class="font-medium text-gray-900">{{ liability.name }}</h3>
                <p class="text-sm text-gray-600">{{ liability.type }}</p>
                @if (getPreviousBalance(liability) !== null) {
                  <p class="text-xs text-gray-500 mt-1">
                    Previous: {{ formatCurrency(getPreviousBalance(liability)) }}
                  </p>
                }
              </div>
              <div class="flex items-center space-x-2">
                <span class="text-gray-600">$</span>
                <input
                  type="number"
                  step="0.01"
                  [value]="getBalance('liability-' + liability.id) ?? ''"
                  (input)="updateBalance('liability-' + liability.id, $any($event.target).value)"
                  placeholder="0.00"
                  class="w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- No Accounts/Liabilities Message -->
    @if (accounts().length === 0 && liabilities().length === 0) {
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
        <p class="text-yellow-800 mb-4">You haven't added any accounts or liabilities yet.</p>
        <a
          routerLink="/finance/accounts"
          class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        >
          Add Accounts
        </a>
      </div>
    }

    <!-- Optional Note -->
    @if (accounts().length > 0 || liabilities().length > 0) {
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Note (Optional)
        </label>
        <textarea
          [value]="note()"
          (input)="note.set($any($event.target).value)"
          rows="3"
          placeholder="Add any notes about this balance entry..."
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        ></textarea>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-3">
        <button
          (click)="saveBalances()"
          [disabled]="saving()"
          class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
        >
          @if (saving()) {
            <span class="flex items-center justify-center">
              <span class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></span>
              Saving...
            </span>
          } @else {
            Save Balances
          }
        </button>
        <button
          (click)="viewDashboard()"
          class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors"
        >
          View Dashboard
        </button>
      </div>
    }
  }
</div>
